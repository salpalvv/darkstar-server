---
    - name: start with an apt 
      apt: name={{item}} state=latest
      with_items: 
        - git
        - libmysqlclient-dev 
        - libluajit-5.1-dev 
        - libzmq3-dev 
        - autoconf 
        - pkg-config
        - build-essential

    - name: remove g++ and cpp 
      apt: name={{item}} state=removed
      with_items: 
        - g++
        - cpp

#    - name: copy the zoneip file onto remote host
#      copy: src=zoneip.sql dest=./

#    - name: set zoneip
#      mysql_db: state=import name=dspdb target=zoneip.sql   

    - name: add ubuntu-toolchain-r repo
      apt_repository: repo='ppa:ubuntu-toolchain-r/test'

    - name: install g++-5
      apt: name=g++-5  state=latest

    - name: add symlinks
      file: 
        src: /usr/bin/{{item.src}} 
        path: /usr/bin/{{item.dest}} 
        state: link
      with_items: 
          - {src: 'gcc-5', dest: 'gcc'}
          - {src: 'g++-5', dest: 'g++'}
          - {src: 'cpp-5', dest: 'cpp'} 

    - name: git clone darkstar
      git: repo=https://github.com/DarkstarProject/darkstar.git
           dest=./darkstar
           version=stable
           depth=1
           force=yes

    - name: run autogen.sh
      command: sh autogen.sh
      args:
        chdir: darkstar

    - name: run configure 
      command: ./configure --enable-debug=gdb
      args:
        chdir: darkstar

    - name: make darkstar
      command: make -j3
      args:
        chdir: darkstar

    - name: copy conf files
      copy: src={{item}} dest=darkstar/conf/
      with_fileglob:
        - conf/*

    - name: copy the cprrect version.info into darkstar
      copy: src=version.info dest=darkstar/

    - shell: ls darkstar/sql/*
      register: path_files

    - name: put the biscuits in the basket 
      mysql_db: state=import name=dspdb target={{ item }}
      with_items: path_files.stdout_lines

    - name: copy the darkstar upstart files 
      copy: src={{item}} dest=/etc/init/
      with_items:
        - dsconnect.conf
        - dsgame.conf
        - dssearch.conf
      tags:
        - startDarkstar

    - name: start the darkstar services
      service: name={{item}} state=started
      with_items: 
        - dsconnect
        - dsgame
        - dssearch
      tags:
        - startDarkstar
